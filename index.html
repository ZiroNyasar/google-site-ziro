<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rahasia</title>
  <style>
    html, body {
      margin:0;
      padding:0;
      height:100%;
      background:#000;
      overflow:hidden;
    }
    /* STRETCH agar selalu pas di semua device (width 100vw & height 100vh, object-fit: fill) */
    video {
      position:fixed;
      top:0;
      left:0;
      width:100vw;
      height:100vh;
      object-fit:fill; /* stretch sesuai permintaan Anda */
      pointer-events:none;
      background:black;
    }
    .overlay {
      position:fixed;
      top:0;
      left:0;
      width:100vw;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2;
      cursor:pointer;
      color:#fff;
      font-family:system-ui,Segoe UI,Roboto,Arial;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      background:rgba(0,0,0,0.35);
    }
    .btn {
      padding:12px 20px;
      border-radius:8px;
      background:rgba(255,255,255,0.08);
      backdrop-filter:blur(4px);
      font-weight:600;
    }
    .loading {
      position:absolute;
      top:16px;
      left:16px;
      color:#ddd;
      font-size:14px;
      z-index:3;
    }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="loading" id="loading">Memuat video...</div>

  <video id="badapple" playsinline loop preload="auto" poster="poster.jpg" crossorigin="anonymous">
    <source src="badapple.mp4" type="video/mp4">
    Browser tidak mendukung video.
  </video>

  <div class="overlay" id="overlay" role="button" aria-label="Putar video">
    <div class="btn" id="label">Putar video</div>
  </div>

  <script>
    const video = document.getElementById('badapple');
    const overlay = document.getElementById('overlay');
    const label = document.getElementById('label');
    const loading = document.getElementById('loading');

    let ready = false;
    let fallback = false;

    // Tunggu video siap (cukup buffer) sebelum menandai siap.
    video.addEventListener('canplaythrough', () => {
      ready = true;
      loading.textContent = 'Siap. Klik untuk putar dengan suara.';
    });

    // Jika metadata sudah ada, juga update status (lebih cepat di beberapa server).
    video.addEventListener('loadedmetadata', () => {
      if (!ready) loading.textContent = 'Memuat metadata...';
    });

    video.addEventListener('error', () => {
      fallback = true;
      loading.textContent = 'Gagal memuat video. Klik overlay untuk unduh.';
      label.textContent = 'Unduh video';
    });

    // Saat user klik: paksa suara aktif lalu play.
    overlay.addEventListener('click', async (e) => {
      e.preventDefault();
      e.stopPropagation();

      // fallback: arahkan ke file jika gagal load
      if (fallback) {
        window.location.href = 'badapple.mp4';
        return;
      }

      // Jika belum siap, beri umpan balik singkat dan coba tetap play
      if (!ready) {
        loading.textContent = 'Masih memuat. Mencoba putar...';
      }

      // Pastikan kita mencoba menjalankan dengan suara aktif.
      try {
        video.muted = false;          // set unmuted sebelum play
        video.volume = 1.0;          // volume penuh (ubah bila perlu)
        await video.play();          // user-initiated play -> biasanya diizinkan
        overlay.style.display = 'none';
        loading.classList.add('hidden');
      } catch (err) {
        // Jika browser menolak (jarang saat ada klik user), coba fallback:
        try {
          // coba play muted (agar minimal video muncul), lalu beri instruksi unmute manual.
          video.muted = true;
          await video.play();
          loading.textContent = 'Pemutaran diblokir untuk suara. Ketuk ikon volume browser untuk aktifkan suara.';
          label.textContent = 'Buka suara';
          // biarkan overlay tampil agar user bisa klik lagi untuk arahkan unduh.
        } catch (err2) {
          // Jika tetap gagal, tawarkan unduh
          loading.textContent = 'Tidak dapat memutar video. Mengunduh...';
          window.location.href = 'badapple.mp4';
        }
      }
    }, { passive:false });

    // Keyboard accesibility (Enter / Space)
    overlay.tabIndex = 0;
    overlay.addEventListener('keydown', (ev) => {
      if (ev.key === 'Enter' || ev.key === ' ') {
        ev.preventDefault();
        overlay.click();
      }
    });

    // Timeout fallback kalau sangat lambat
    setTimeout(() => {
      if (!ready && !fallback) {
        loading.textContent = 'Memuat lama. Klik untuk coba unduh.';
        label.textContent = 'Unduh video';
        fallback = true;
      }
    }, 12000);
  </script>
</body>
</html>
