<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Video Fullscreen</title>
  <style>
    html,body {
      margin:0;
      padding:0;
      height:100%;
      background:#000;
      overflow:hidden;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
      color:#fff;
    }

    video {
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      object-fit:contain;
      background:black;
      pointer-events:none;
    }

    .overlay {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:2;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      background:rgba(0,0,0,0.35);
      transition:background .18s;
    }

    .card {
      display:flex;
      gap:16px;
      align-items:center;
      padding:14px 18px;
      border-radius:12px;
      background:rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
      box-shadow:0 6px 18px rgba(0,0,0,0.6);
    }

    .spinner {
      width:20px;
      height:20px;
      border-radius:50%;
      border:3px solid rgba(255,255,255,0.12);
      border-top-color:rgba(255,255,255,0.9);
      animation:spin .9s linear infinite;
    }

    @keyframes spin{to{transform:rotate(360deg)}}

    .text {
      font-size:16px;
      line-height:1;
      white-space:nowrap;
    }

    .play {
      display:inline-block;
      padding:8px 14px;
      border-radius:8px;
      background:rgba(255,255,255,0.12);
      font-weight:600;
      cursor:pointer;
      margin-left:6px;
    }

    .hint {
      font-size:12px;
      opacity:0.8;
      margin-top:6px;
      text-align:center;
    }

    .hidden { display:none; }

    .muted-note {
      font-size:12px;
      opacity:0.85;
      margin-left:8px;
    }
  </style>
</head>
<body>
  <!-- Tambahkan poster.jpg (thumbnail) di folder yang sama jika ada -->
  <video id="badapple" playsinline loop preload="auto" muted poster="poster.jpg" crossorigin="anonymous">
    <source src="badapple.mp4" type="video/mp4" />
    Browser Anda tidak mendukung video.
  </video>

  <div class="overlay" id="overlay" role="button" aria-live="polite">
    <div class="card" id="card">
      <div class="spinner" id="spinner" aria-hidden="true"></div>
      <div>
        <div class="text" id="status">Memuat video...</div>
        <div class="hint" id="hint">Klik untuk memulai saat siap</div>
      </div>
      <div class="play hidden" id="playBtn" aria-hidden="true">Putar</div>
    </div>
  </div>

  <script>
    const video = document.getElementById('badapple');
    const overlay = document.getElementById('overlay');
    const spinner = document.getElementById('spinner');
    const status = document.getElementById('status');
    const playBtn = document.getElementById('playBtn');
    const hint = document.getElementById('hint');

    let ready = false;
    let fallback = false;

    // Jika video tersedia lokal tapi server lambat, canplaythrough menandakan data cukup.
    function markReady() {
      if (ready) return;
      ready = true;
      spinner.classList.add('hidden');
      playBtn.classList.remove('hidden');
      status.textContent = 'Siap diputar';
      playBtn.setAttribute('aria-hidden', 'false');
    }

    // Jika metadata dimuat cepat, bisa juga aktifkan.
    video.addEventListener('loadedmetadata', () => {
      if (video.readyState >= 3) {
        markReady();
      } else {
        status.textContent = 'Memuat metadata...';
      }
    });

    video.addEventListener('canplaythrough', () => {
      markReady();
    });

    // Tangani kesalahan loading
    video.addEventListener('error', () => {
      spinner.classList.add('hidden');
      playBtn.classList.remove('hidden');
      status.textContent = 'Gagal memuat video';
      hint.textContent = 'Klik untuk mengunduh atau coba lagi';
      fallback = true;
    });

    // Jika server lambat tapi user klik, beri respon yang jelas
    overlay.addEventListener('click', async (e) => {
      // Jika fallback (error), arahkan ke file
      if (fallback) {
        window.location.href = 'badapple.mp4';
        return;
      }

      // Jika belum siap, beri umpan balik
      if (!ready) {
        status.textContent = 'Masih memuat. Tunggu sebentar atau klik untuk coba unduh';
        spinner.classList.remove('hidden');
        return;
      }

      // Coba mainkan video. Tangani promise rejection (autoplay blocked)
      try {
        await video.play();
        overlay.style.display = 'none';
      } catch (err) {
        // Jika pemutaran diblokir, coba minta user mengizinkan suara.
        try {
          // Pastikan video tetap muted agar bisa play di beberapa browser
          video.muted = true;
          await video.play();
          overlay.style.display = 'none';
        } catch (err2) {
          // Jika tetap gagal, tampilkan instruksi singkat
          status.textContent = 'Pemutaran diblokir oleh browser';
          hint.textContent = 'Klik ikon play pada kontrol browser atau unduh file';
          playBtn.textContent = 'Unduh';
          fallback = true;
        }
      }
    });

    // Jika user menekan tombol keyboard Enter atau Space saat overlay fokus
    overlay.tabIndex = 0;
    overlay.addEventListener('keydown', async (ev) => {
      if (ev.key === 'Enter' || ev.key === ' ') {
        ev.preventDefault();
        overlay.click();
      }
    });

    // Jika ingin autoplay saat siap tanpa menutup overlay, aktifkan ini.
    // Tapi saya biarkan dinonaktifkan supaya tidak terlihat mencurigakan.
    // Jika ingin, bisa uncomment baris berikut:
    // video.addEventListener('canplaythrough', () => { video.play().catch(()=>{}); });

    // Jika file terlalu besar atau koneksi lambat, berikan timeout fallback
    const fallbackTimeout = setTimeout(() => {
      if (!ready && !fallback) {
        spinner.classList.add('hidden');
        playBtn.classList.remove('hidden');
        status.textContent = 'Memuat lama';
        hint.textContent = 'Klik untuk coba unduh';
        fallback = true;
      }
    }, 12000); // 12 detik
  </script>
</body>
</html>
